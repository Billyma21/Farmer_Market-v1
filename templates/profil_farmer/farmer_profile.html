<!-- templates/profil_farmer/farmer_profile.html -->

{% extends "base.html" %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/profile_farmer/farmer_profile.css' %}">
 <!-- Liens vers les fichiers CSS de Leaflet -->
 <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<div class="profile-container">
    <!-- Profil Header Section -->
    <div class="profile-header">
        <div class="profile-image">
            <!-- Image du fermier ou image par défaut -->
            {% if farmer.farm_images %}
                <img src="{{ farmer.farm_images.url }}" alt="Image de la ferme" class="profile-img">
            {% else %}
                <img src="{% static 'images/default-profile.jpg' %}" alt="Image par défaut" class="profile-img">
            {% endif %}
        </div>

        <div class="profile-info">
            <h1>{{ farmer.farmer.username }}</h1>
            <p class="email"><i class="fa fa-envelope"></i> {{ farmer.farmer.email }}</p>
            <p class="phone"><i class="fa fa-phone"></i> {{ farmer.phone_number }}</p>
            {% if farmer.website %}
                <p class="website">
                    <i class="fa fa-globe"></i>
                    <a href="{{ farmer.website }}" target="_blank">{{ farmer.website }}</a>
                </p>
            {% endif %}
        </div>

        <div class="edit-button">
            <a href="{% url 'edit_profile' %}" class="btn btn-primary">Modifier le profil</a>
        </div>
    </div>

    <!-- Profil Details Section -->
    <div class="profile-details">
        <h2>À propos de la ferme</h2>
        <p><strong>Description :</strong> {{ farmer.description }}</p>
        <p><strong>Adresse :</strong> {{ farmer.address }}</p>
        <p><strong>Secteur agricole :</strong> {{ farmer.agriculture_sector }}</p>
        <p><strong>Services :</strong> {{ farmer.services }}</p>
        <p><strong>Horaires :</strong> {{ farmer.opening_hours }}</p>
        {% if farmer.additional_info %}
            <p><strong>Informations supplémentaires :</strong> {{ farmer.additional_info }}</p>
        {% endif %}
    </div>

    <!-- Interactive Map Section -->
    <div class="profile-map">
        <h2>Localisation de la ferme</h2>
        <div id="map" style="height: 400px; border-radius: 8px;"></div> <!-- Carte -->
    </div>

    <!-- Social Media or Contact Section -->
    <div class="contact-section">
        <h3>Restez connectés</h3>
        <p><i class="fa fa-facebook"></i> <a href="https://facebook.com/{{ farmer.farmer.username }}" target="_blank">Facebook</a></p>
        <p><i class="fa fa-instagram"></i> <a href="https://instagram.com/{{ farmer.farmer.username }}" target="_blank">Instagram</a></p>
        <p><i class="fa fa-twitter"></i> <a href="https://twitter.com/{{ farmer.farmer.username }}" target="_blank">Twitter</a></p>
    </div>

    <!-- Testimonials or Reviews Section -->
    <div class="testimonials-section">
        <h3>Témoignages</h3>
        <div class="testimonial">
            <p><strong>Marie L. :</strong> "Une ferme magnifique, j'y ai acheté des produits locaux incroyables!"</p>
        </div>
        <div class="testimonial">
            <p><strong>Jean P. :</strong> "Service très professionnel et accueil chaleureux. À recommander!"</p>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
    // Assurez-vous que les coordonnées sont bien passées depuis le backend
    const latitude = {{ farmer.latitude|safe }};
    const longitude = {{ farmer.longitude|safe }};

    if (latitude && longitude) {
        // Initialisation de la carte
        const map = L.map('map').setView([latitude, longitude], 13);

        // Ajout des tuiles OpenStreetMap avec une option de zoom maximal
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors',
            maxZoom: 18,
        }).addTo(map);

        // Icône personnalisée du marqueur
        const markerIcon = L.icon({
            iconUrl: '{% static "images/marker-icon.png" %}', // Assurez-vous que le fichier marker-icon.png est présent dans votre dossier 'static/images'
            iconSize: [25, 41], 
            iconAnchor: [12, 41], 
            popupAnchor: [1, -34],
        });

        // Placer un marqueur à l'adresse de la ferme
        const marker = L.marker([latitude, longitude], { icon: markerIcon }).addTo(map)
            .bindPopup("<b>{{ farmer.farmer.username }}</b><br>{{ farmer.address }}")
            .openPopup();
    } else {
        alert("Les coordonnées géographiques de la ferme sont manquantes.");
    }
</script>

{% endblock %} 







{% comment %} {% extends "base.html" %}
{% block content %}
<h1>Profil du Fermier</h1>
<div>
    <p><strong>Nom : </strong>{{ farmer.farmer.username }}</p>
    <p><strong>Email : </strong>{{ farmer.farmer.email }}</p>
    <p><strong>Description : </strong>{{ farmer.description }}</p>
    <p><strong>Adresse : </strong>{{ farmer.address }}</p>
    <p><strong>Téléphone : </strong>{{ farmer.phone_number }}</p>
    <p><strong>Site Web : </strong><a href="{{ farmer.website }}" target="_blank">{{ farmer.website }}</a></p>

    <div id="map" style="height: 400px;"></div>
</div>

<a href="{% url 'edit_profile' %}" class="btn btn-primary">Modifier le profil</a>

<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script>
    var map = L.map('map').setView([{{ farmer.latitude }}, {{ farmer.longitude }}], 13);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(map);
    L.marker([{{ farmer.latitude }}, {{ farmer.longitude }}]).addTo(map)
        .bindPopup("<b>{{ farmer.farmer.username }}</b><br>{{ farmer.address }}");
</script>
{% endblock %}

 {% endcomment %}


{% comment %} {% extends "base.html" %}
{% load static %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/farmer_profile.css' %}">

<h1>Profil du Fermier</h1>

<div>
    <p><strong>Nom : </strong>{{ farmer.farmer.username }}</p>
    <p><strong>Email : </strong>{{ farmer.farmer.email }}</p>
    <p><strong>Description : </strong>{{ farmer.description }}</p>
    <p><strong>Adresse : </strong>{{ farmer.address }}</p>
    <p><strong>Téléphone : </strong>{{ farmer.phone_number }}</p>
    <p><strong>Site Web : </strong><a href="{{ farmer.website }}" target="_blank">{{ farmer.website }}</a></p>
    <p><strong>Latitude : </strong>{{ farmer.latitude }}</p>
    <p><strong>Longitude : </strong>{{ farmer.longitude }}</p>

    <!-- Affichage de la carte -->
    <div id="map" style="height: 400px; width: 100%;"></div>
</div>

<a href="{% url 'farmer_dashboard' %}" class="btn btn-secondary">Retour au tableau de bord</a>
<a href="{% url 'edit_profile' %}" class="btn btn-primary">Modifier le profil</a>

{% endblock %}

{% block scripts %}
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&callback=initMap" async defer></script>
<script>
    function initMap() {
        var location = { lat: {{ farmer.latitude }}, lng: {{ farmer.longitude }} };
        var map = new google.maps.Map(document.getElementById('map'), {
            zoom: 15,
            center: location
        });
        var marker = new google.maps.Marker({
            position: location,
            map: map
        });
    }
</script>
{% endblock %} {% endcomment %}
